<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Proposer un service - Love Market</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="logo">ğŸ’• Love Market</div>
      <% if (user) { %>
      <nav class="nav">
        <a href="/dashboard" title="Dashboard" class="<%= currentPath === '/dashboard' ? 'nav-active' : '' %>">ğŸ <span class="nav-text"> Accueil</span></a>
        <a href="/shop" title="Boutique" class="<%= currentPath === '/shop' ? 'nav-active' : '' %>">ğŸ›ï¸<span class="nav-text"> Boutique</span></a>
        <a href="/my-services" title="Mes services" class="<%= currentPath === '/my-services' ? 'nav-active' : '' %>">ğŸ¤<span class="nav-text"> Mes services</span></a>
        <a href="/negotiations" title="NÃ©gociations" class="nav-link-with-badge <%= currentPath === '/negotiations' ? 'nav-active' : '' %>">
          ğŸ’¬<span class="nav-text"> NÃ©gociations</span>
          <% if (notificationCount > 0) { %>
          <span class="notification-badge"><%= notificationCount %></span>
          <% } %>
        </a>
        <% if (user.role === 'admin') { %>
        <a href="/admin" class="admin-link <%= currentPath === '/admin' ? 'nav-active' : '' %>" title="Admin">âš™ï¸<span class="nav-text"> Admin</span></a>
        <% } %>
      </nav>
      <div class="user-info">
        <span class="credits"><%= user.credits %> â¤ï¸</span>
        <span class="user-name"><%= user.displayName %></span>
        <a href="/logout" class="logout">DÃ©connexion</a>
      </div>
      <% } %>
    </header>

    <main class="page">
      <section class="section">
        <h1 class="section-title">Proposer un service âœ¨</h1>

        <div class="card">
          <h2 class="card-title">Nouvelle proposition pour <%= partner.displayName %></h2>
          <p class="hint">
            Propose un service que tu peux offrir Ã  ton/ta partenaire, contre des crÃ©dits.
            S'il/elle accepte, ses crÃ©dits seront dÃ©bitÃ©s et tu seras crÃ©ditÃ©(e).
          </p>

          <form method="post" action="/offer-service" class="form">
            <label>
              Titre du service proposÃ©
              <input 
                type="text" 
                name="title" 
                placeholder="Ex: Massage relaxant 30 min" 
                required 
              />
            </label>

            <label>
              Description / dÃ©tails
              <textarea 
                name="description" 
                rows="3" 
                placeholder="DÃ©cris ce que tu proposes..."
              ></textarea>
            </label>

            <label>
              CatÃ©gorie
              <select name="category">
                <option value="Romantique">Romantique</option>
                <option value="DÃ©tente">DÃ©tente</option>
                <option value="Fun">Fun</option>
                <option value="Maison">Maison</option>
                <option value="Sortie">Sortie</option>
                <option value="Famille">Famille</option>
                <option value="Enfants">Enfants</option>
                <option value="Cuisine">Cuisine</option>
                <option value="Voyage">Voyage</option>
                <option value="Bien-Ãªtre">Bien-Ãªtre</option>
              </select>
            </label>

            <label>
              IcÃ´ne
              <select name="icon">
                <option value="ğŸ›">ğŸ› Salle de bain / mÃ©nage</option>
                <option value="ğŸ¥">ğŸ¥ Petit dÃ©jeuner / cuisine</option>
                <option value="ğŸ½ï¸">ğŸ½ï¸ Restaurant / sortie</option>
                <option value="ğŸ’†">ğŸ’† Massage / dÃ©tente</option>
                <option value="ğŸ²">ğŸ² SoirÃ©e fun / jeux</option>
                <option value="ğŸ“º">ğŸ“º SÃ©ries / film</option>
                <option value="ğŸ‘¶">ğŸ‘¶ Garde enfants</option>
                <option value="ğŸŒ¹">ğŸŒ¹ Geste romantique</option>
                <option value="ğŸ‰">ğŸ‰ FÃªte / anniversaire</option>
                <option value="ğŸš—">ğŸš— Sortie / balade</option>
                <option value="ğŸ’—">ğŸ’— Autre</option>
              </select>
            </label>

            <label>
              Prix demandÃ© (en crÃ©dits â¤ï¸)
              <input 
                type="number" 
                name="offeredPrice" 
                min="0" 
                step="1" 
                value="30"
                onchange="updateSuperServicePrice(this)"
                required
              />
            </label>

            <!-- NEW: Super service option -->
            <label class="checkbox-label">
              <input type="checkbox" name="isSuperService" value="true" onchange="updateSuperServicePrice(document.querySelector('input[name=offeredPrice]'))" />
              <span class="checkbox-custom"></span>
              Service bonus (+30% de crÃ©dits pour toi)
            </label>
            <div id="superServiceInfo" style="margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px; display: none;">
              <p style="margin: 0; color: #2c5aa0; font-weight: bold;" id="superServiceText"></p>
            </div>

            <p class="hint">
              Ton/ta partenaire paiera seulement s'il/elle accepte la proposition.
            </p>

            <button type="submit" class="btn-primary">Envoyer la proposition</button>
            <a href="/dashboard" class="btn-secondary">Annuler</a>
          </form>
          <script>
            function updateSuperServicePrice(priceInput) {
              const checkbox = document.querySelector('input[name=isSuperService]');
              const infoDiv = document.getElementById('superServiceInfo');
              const superServiceText = document.getElementById('superServiceText');
              
              if (checkbox.checked) {
                const basePrice = parseInt(priceInput.value) || 0;
                const bonus = Math.round(basePrice * 0.3);
                const total = basePrice + bonus;
                
                superServiceText.textContent = `Service bonus : Si acceptÃ©, tu recevras ${basePrice} â¤ï¸ (prix) + ${bonus} â¤ï¸ (bonus) = ${total} â¤ï¸ au total !`;
                infoDiv.style.display = 'block';
              } else {
                infoDiv.style.display = 'none';
              }
            }
          </script>
        </div>
      </section>
    </main>
  </body>
</html>
